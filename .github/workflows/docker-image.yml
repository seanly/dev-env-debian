name: Deploy to Github pages
#on:
#  push:
#    branches: [ "create-deploy-qt-wasm-gh-pages" ]
on: workflow_dispatch

jobs:

  deploy-to-github-pages:
    runs-on: ubuntu-22.04
    steps:
    
    - name : Checkout source code
      uses: actions/checkout@v3

    - name: Install Emscripten
      uses: mymindstorm/setup-emsdk@v11
      with:
        version: 3.1.14
  
    - name: Install Qt WASM
      uses: jurplel/install-qt-action@v3
      with:
        aqtversion: '==2.1.*'
        version: '6.4.2'
        host: 'linux'
        target: 'desktop'
        arch: 'wasm_32'
        
    - name: Install Qt GCC
      uses: jurplel/install-qt-action@v3
      with:
        aqtversion: '==2.1.*'
        version: '6.4.2'
        host: 'linux'
        target: 'desktop'
        arch: 'gcc_64'
        tools: 'tools_cmake tools_ninja'
        
    - name: Build the Qt6QuickApp to the build_wasm folder
      run: |
         pwd 
         ls -alh .
         ls -alh /home/runner/work/dev-env-debian/Qt
         /home/runner/work/dev-env-debian/Qt/Tools/CMake/bin/cmake \
           -S Qt6QuickApp  \
           -B build-Qt6QuickApp-WebAssembly-Debug \
           -DCMAKE_BUILD_TYPE:STRING=Debug \
           -DCMAKE_PREFIX_PATH:PATH=/home/runner/work/dev-env-debian/Qt/6.4.2/wasm_32 \
           -DCMAKE_C_COMPILER:FILEPATH=${EMSDK}/upstream/emscripten/emcc \
           -DCMAKE_CXX_COMPILER:FILEPATH=${EMSDK}/upstream/emscripten/em++  \
           -DCMAKE_TOOLCHAIN_FILE:FILEPATH=/home/runner/work/dev-env-debian/Qt/6.4.2/wasm_32/lib/cmake/Qt6/qt.toolchain.cmake \
           -DCMAKE_CXX_FLAGS_INIT:STRING=-DQT_QML_DEBUG 
         /home/runner/work/dev-env-debian/Qt/Tools/CMake/bin/cmake --build build-Qt6QuickApp-WebAssembly-Debug --target all
           
    - name: uploade Artifacts 
      uses: actions/upload-artifact@v3
      with:
        name: build-Qt6QuickApp-WebAssembly-Debug
        path: build-Qt6QuickApp-WebAssembly-Debug
